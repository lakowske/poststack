<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
    xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                        http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.0.xsd">

    <!-- Initial data for Poststack v1.0 -->
    
    <changeSet id="201-insert-system-info" author="poststack">
        <insert schemaName="poststack" tableName="system_info">
            <column name="key" value="schema_version"/>
            <column name="value" value="1.0.0"/>
        </insert>
        <insert schemaName="poststack" tableName="system_info">
            <column name="key" value="created_by"/>
            <column name="value" value="liquibase"/>
        </insert>
        <insert schemaName="poststack" tableName="system_info">
            <column name="key" value="poststack_version"/>
            <column name="value" value="0.1.0"/>
        </insert>
        <insert schemaName="poststack" tableName="system_info">
            <column name="key" value="database_initialized"/>
            <column name="value" value="true"/>
        </insert>
        <rollback>
            <delete schemaName="poststack" tableName="system_info">
                <where>key IN ('schema_version', 'created_by', 'poststack_version', 'database_initialized')</where>
            </delete>
        </rollback>
    </changeSet>

    <changeSet id="202-insert-default-services" author="poststack">
        <insert schemaName="poststack" tableName="services">
            <column name="name" value="postgresql"/>
            <column name="type" value="database"/>
            <column name="status" value="configured"/>
            <column name="config" value='{"image": "poststack/postgres", "port": 5432}'/>
        </insert>
        <insert schemaName="poststack" tableName="services">
            <column name="name" value="apache"/>
            <column name="type" value="web"/>
            <column name="status" value="configured"/>
            <column name="config" value='{"image": "poststack/apache", "ports": [80, 443]}'/>
        </insert>
        <insert schemaName="poststack" tableName="services">
            <column name="name" value="dovecot"/>
            <column name="type" value="mail"/>
            <column name="status" value="configured"/>
            <column name="config" value='{"image": "poststack/dovecot", "ports": [143, 993, 110, 995]}'/>
        </insert>
        <insert schemaName="poststack" tableName="services">
            <column name="name" value="bind"/>
            <column name="type" value="dns"/>
            <column name="status" value="configured"/>
            <column name="config" value='{"image": "poststack/bind", "ports": [53]}'/>
        </insert>
        <insert schemaName="poststack" tableName="services">
            <column name="name" value="certbot"/>
            <column name="type" value="certificate"/>
            <column name="status" value="configured"/>
            <column name="config" value='{"image": "poststack/certbot", "schedule": "0 12 * * *"}'/>
        </insert>
        <rollback>
            <delete schemaName="poststack" tableName="services">
                <where>name IN ('postgresql', 'apache', 'dovecot', 'bind', 'certbot')</where>
            </delete>
        </rollback>
    </changeSet>

</databaseChangeLog>